<Macro RailsProduction $user $application>
  <VirtualHost *:443>
    # Serve rails applications in production mode
  
    UseCanonicalName Off
  
    ServerName $application.HVboom.biz
    VirtualDocumentRoot "/home/$user/RubyOnRails/$application/public"
  
    PassengerEnabled on
    PassengerAppEnv "production"
    PassengerRuby "/home/$user/RubyOnRails/$application/bin/ruby_wrapper.rb"

    SetEnv RAILS_LOG_LEVEL "warn"
  
    # Prevent Passenger from compiling native support at runtime
    SetEnv PASSENGER_COMPILE_NATIVE_SUPPORT_BINARY 0
    SetEnv PASSENGER_DOWNLOAD_NATIVE_SUPPORT_BINARY 0

    RailsBaseURI "/"
    <Directory "/home/$user/RubyOnRails/$application/public">
      Require all granted
      Options -MultiViews 
    </Directory>
  
    SSLEngine on
  </VirtualHost>
</Macro>

<Macro Rails $environment $user $application>
  <VirtualHost *:443>
    # Serve rails applications in production like mode
  
    UseCanonicalName Off
  
    ServerName $application.$user.HVboom.biz
    VirtualDocumentRoot "/home/$user/RubyOnRails/$application/public"
  
    PassengerEnabled on
    PassengerAppEnv "$environment"
    PassengerRuby "/home/$user/RubyOnRails/$application/bin/ruby_wrapper.rb"
  
    # Prevent Passenger from compiling native support at runtime
    SetEnv PASSENGER_COMPILE_NATIVE_SUPPORT_BINARY 0
    SetEnv PASSENGER_DOWNLOAD_NATIVE_SUPPORT_BINARY 0

    # Keep runtime away from user dotfiles (Passenger runs as www-data)
    SetEnv HOME "/tmp/passenger-$user"
    SetEnv TMPDIR "/tmp"

    RailsBaseURI "/"
    <Directory "/home/$user/RubyOnRails/$application/public">
      Require all granted
      Options -MultiViews 
    </Directory>
  
    SSLEngine on
  </VirtualHost>
</Macro>

<Macro Docs $user $application>
  <VirtualHost *:443>
    ServerName $application.$user.docs.HVboom.biz
    # DocumentRoot "/home/$user/RubyOnRails/$application/docs/_site"
    VirtualDocumentRoot "/home/$user/RubyOnRails/$application/docs/_site"

    <Directory "/home/$user/RubyOnRails/$application/docs/_site">
      Options FollowSymLinks
      AllowOverride All
      Require all granted
    </Directory>

    SSLEngine on

    ErrorLog ${APACHE_LOG_DIR}/docs.$application.$user.error.log
    CustomLog ${APACHE_LOG_DIR}/docs.$application.$user.access.log combined
  </VirtualHost>
</Macro>

Use Rails development mario            HVDigitalSafe
Use Rails demo        demo             HVDigitalSafe
Use RailsProduction   hvdigitalsafe    HVDigitalSafe

Use Rails development mario            HVKeyGuard
Use Rails demo        demo             HVKeyGuard
Use RailsProduction   hvkeyguard       HVKeyGuard

Use Rails development mario            HVPlayground
# Use Rails demo        demo             HVPlayground
# Use RailsProduction   hvplayground     HVPlayground
# 
# Use Rails development mario            HVMembership
# Use Rails demo        demo             HVMembership
# Use RailsProduction   hvmembership     HVMembership
# 
# Use Rails development mario            HVControlTower
# Use Rails demo        demo             HVControlTower
# Use RailsProduction   hvcontroltower   HVControlTower
# 
# Use Rails development mario            HVEntitlement
# Use Rails demo        demo             HVEntitlement
# Use RailsProduction   hventitlement    HVEntitlement
# 
# Use Rails development mario            HVLogger
# Use Rails demo        demo             HVLogger
# Use Rails production  hvlogger         HVLogger
# 
# Use Rails development mario            HVLookBook
# Use Rails demo        demo             HVLookBook
# Use Rails production  hvlookbook       HVLookBook
# 
Use Rails development mario            HVCMS
# Use Rails demo        demo             HVCMS
# Use Rails production  hvcms            HVCMS
Use Docs              mario            HVCMS

UndefMacro RailsProduction
UndefMacro Rails
UndefMacro Docs
